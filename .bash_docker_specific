set -e
[[ ! -f "/etc/init.d/docker" ]] && {
  printf "Installing ${BGreen}docker${NC}\n"
  sudo apt-get update
  sudo apt-get -y install apt-transport-https ca-certificates curl
  curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
	sudo add-apt-repository \
		 "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
		 $(lsb_release -cs) \
		 stable"
  sudo apt-get update
  sudo apt-get -y install linux-image-extra-$(uname -r) linux-image-extra-virtual
  sudo apt-get -y install docker-ce
  docker run hello-world
}

[[ ! -f /etc/bash_completion.d/docker ]] && {
  URL="https://raw.githubusercontent.com/docker/docker/master/contrib/completion/bash/docker "
  sudo bash -c "curl -L $URL > /etc/bash_completion.d/docker"
}

[[ "$( cat /proc/version | grep -q 'Microsoft' && echo $? )" -eq "0" ]] && {
  printf "${BYellow}INFO${NC}: Connecting Docker-Windows engine to native Linux session\n"
  export DOCKER_HOST=tcp://0.0.0.0:2375
}

mkdir -p "$HOME/.loaded"
touch "$HOME/.loaded/.$(basename $0)"
